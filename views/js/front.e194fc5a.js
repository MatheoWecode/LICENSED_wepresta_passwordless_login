/*!
 * Module for PrestaShop
 *
 *                 xxxx
 *                 xxxx
 *
 *                 @author      WePresta
 *                 @copyright   2026 WePresta
 *                 @license     MIT
 */
"use strict";(self.webpackChunkwepresta_passwordless_login=self.webpackChunkwepresta_passwordless_login||[]).push([[440],{2299:function(e,t,o){var n,i;o(8992),o(2577);n=jQuery,i={apiUrl:"",csrfToken:"",googleEnabled:!1,googleClientId:"",resendCountdown:60,backUrl:"",email:"",currentStep:"email",countdownTimer:null,loading:!1,init:function(){var e=n("#passwordless-login");if(e.length){this.apiUrl=e.data("api-url"),this.csrfToken=e.data("csrf-token"),this.googleEnabled=!!e.data("google-enabled"),this.googleClientId=e.data("google-client-id")||"",this.resendCountdown=parseInt(e.data("resend-countdown"),10)||60,this.backUrl=e.data("back-url")||"",this.bindEvents(),this.googleEnabled&&this.googleClientId&&this.initGoogleSignIn();var t=this;n(window).on("popstate",function(e){var o=e.originalEvent.state;o&&o.step&&t.showStep(o.step,!0)}),history.replaceState({step:"email"},"",window.location.href)}},bindEvents:function(){var e=this;n("#pl-email-form").on("submit",function(t){t.preventDefault(),e.sendCode()}),n(document).on("input",".pl-code-digit",function(){e.handleCodeInput(n(this))}),n(document).on("keydown",".pl-code-digit",function(t){e.handleCodeKeydown(n(this),t)}),n(document).on("paste",".pl-code-digit",function(t){t.preventDefault();var o=(t.originalEvent.clipboardData||window.clipboardData).getData("text");e.handleCodePaste(o)}),n("#pl-profile-form").on("submit",function(t){t.preventDefault(),e.completeProfile()}),n("#pl-resend-btn").on("click",function(){n(this).prop("disabled")||e.sendCode()}),n("#pl-back-to-email").on("click",function(){e.showStep("email")}),n("#pl-back-to-code").on("click",function(){e.showStep("code")})},showStep:function(e,t){this.currentStep=e,n(".pl-step").hide(),n('.pl-step[data-step="'+e+'"]').fadeIn(200),n("#pl-code-error").hide(),t||history.pushState({step:e},"",window.location.href),"email"===e?setTimeout(function(){n("#pl-email").focus()},250):"code"===e?setTimeout(function(){n(".pl-code-digit").first().focus()},250):"profile"===e&&setTimeout(function(){n("#pl-firstname").focus()},250)},sendCode:function(){var e=this,t=n.trim(n("#pl-email").val());t&&this.isValidEmail(t)?(this.email=t,this.setLoading("#pl-send-code-btn",!0),n.ajax({url:this.apiUrl,method:"POST",dataType:"json",data:{action:"sendCode",email:t,token:this.csrfToken},success:function(t){if(t.success){n("#pl-code-subtitle").html((n("#pl-code-subtitle").closest(".pl-card").find(".pl-title").text(),e.email));var o=n("#pl-code-subtitle");o.html(o.data("template")||"Code sent to <strong>"+e.escapeHtml(e.email)+"</strong>"),o.html("Code sent to <strong>"+e.escapeHtml(e.email)+"</strong>"),e.showStep("code"),e.clearCodeInputs(),e.startCountdown()}else e.showMessage(t.error||"An error occurred.","error")},error:function(){e.showMessage("An error occurred. Please try again.","error")},complete:function(){e.setLoading("#pl-send-code-btn",!1)}})):this.showFieldError(n("#pl-email"))},handleCodeInput:function(e){var t=e.val().replace(/[^0-9]/g,"");if(e.val(t),1===t.length){e.addClass("pl-code-digit--filled").removeClass("pl-code-digit--error");var o=e.closest(".pl-code-inputs").find('.pl-code-digit[data-index="'+(parseInt(e.data("index"),10)+1)+'"]');o.length&&o.focus()}this.checkCodeComplete()},handleCodeKeydown:function(e,t){if("Backspace"===t.key){if(""===e.val()){var o=e.closest(".pl-code-inputs").find('.pl-code-digit[data-index="'+(parseInt(e.data("index"),10)-1)+'"]');o.length&&o.val("").removeClass("pl-code-digit--filled").focus()}else e.val("").removeClass("pl-code-digit--filled");t.preventDefault()}if("ArrowLeft"===t.key){var n=e.closest(".pl-code-inputs").find('.pl-code-digit[data-index="'+(parseInt(e.data("index"),10)-1)+'"]');n.length&&n.focus()}if("ArrowRight"===t.key){var i=e.closest(".pl-code-inputs").find('.pl-code-digit[data-index="'+(parseInt(e.data("index"),10)+1)+'"]');i.length&&i.focus()}},handleCodePaste:function(e){var t=e.replace(/[^0-9]/g,"").substring(0,6);if(0!==t.length){for(var o=n(".pl-code-digit"),i=0;i<t.length&&i<6;i++)o.eq(i).val(t[i]).addClass("pl-code-digit--filled");t.length<6?o.eq(t.length).focus():(o.eq(5).focus(),this.checkCodeComplete())}},clearCodeInputs:function(){n(".pl-code-digit").val("").removeClass("pl-code-digit--filled pl-code-digit--error")},checkCodeComplete:function(){var e="",t=!0;n(".pl-code-digit").each(function(){var o=n(this).val();1!==o.length&&(t=!1),e+=o}),t&&6===e.length&&this.verifyCode(e)},verifyCode:function(e){var t=this;this.loading||(this.loading=!0,n.ajax({url:this.apiUrl,method:"POST",dataType:"json",data:{action:"verifyCode",email:this.email,code:e,token:this.csrfToken},success:function(e){e.success?e.needsProfile?(e.firstName&&n("#pl-firstname").val(e.firstName),e.lastName&&n("#pl-lastname").val(e.lastName),t.showStep("profile")):(t.showMessage("Logged in successfully!","success"),window.location.href=t.backUrl||e.redirectUrl||window.location.origin):(t.showCodeError(e.error||"Invalid code."),t.clearCodeInputs(),setTimeout(function(){n(".pl-code-digit").first().focus()},100))},error:function(){t.showCodeError("An error occurred. Please try again."),t.clearCodeInputs()},complete:function(){t.loading=!1}}))},showCodeError:function(e){n("#pl-code-error").text(e).show(),n(".pl-code-digit").addClass("pl-code-digit--error")},completeProfile:function(){var e=this,t=n.trim(n("#pl-firstname").val()),o=n.trim(n("#pl-lastname").val());t?o?(this.setLoading("#pl-complete-btn",!0),n.ajax({url:this.apiUrl,method:"POST",dataType:"json",data:{action:"completeProfile",email:this.email,firstname:t,lastname:o,token:this.csrfToken},success:function(t){t.success?(e.showMessage("Account created!","success"),window.location.href=e.backUrl||t.redirectUrl||window.location.origin):e.showMessage(t.error||"An error occurred.","error")},error:function(){e.showMessage("An error occurred. Please try again.","error")},complete:function(){e.setLoading("#pl-complete-btn",!1)}})):this.showFieldError(n("#pl-lastname")):this.showFieldError(n("#pl-firstname"))},initGoogleSignIn:function(){var e=this,t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=function(){"undefined"!=typeof google&&google.accounts&&(google.accounts.id.initialize({client_id:e.googleClientId,callback:function(t){e.handleGoogleAuth(t.credential)}}),n("#pl-google-btn").on("click",function(){google.accounts.id.prompt()}))},document.head.appendChild(t)},handleGoogleAuth:function(e){var t=this;this.setLoading("#pl-google-btn",!0),n.ajax({url:this.apiUrl,method:"POST",dataType:"json",data:{action:"googleAuth",credential:e,token:this.csrfToken},success:function(e){e.success?e.needsProfile?(t.email=e.email||"",e.firstName&&n("#pl-firstname").val(e.firstName),e.lastName&&n("#pl-lastname").val(e.lastName),t.showStep("profile")):(t.showMessage("Logged in successfully!","success"),window.location.href=t.backUrl||e.redirectUrl||window.location.origin):t.showMessage(e.error||"Google authentication failed.","error")},error:function(){t.showMessage("An error occurred. Please try again.","error")},complete:function(){t.setLoading("#pl-google-btn",!1)}})},startCountdown:function(){var e=this,t=this.resendCountdown,o=n("#pl-resend-btn"),i=n("#pl-countdown"),s=n("#pl-countdown-wrap");o.prop("disabled",!0),s.show(),this.countdownTimer&&clearInterval(this.countdownTimer);var a=function(){var e=Math.floor(t/60),o=t%60;i.text(e+":"+(o<10?"0":"")+o)};a(),this.countdownTimer=setInterval(function(){--t<=0?(clearInterval(e.countdownTimer),o.prop("disabled",!1),s.hide()):a()},1e3)},setLoading:function(e,t){var o=n(e);t?(o.prop("disabled",!0),o.find(".pl-btn__text").hide(),o.find(".pl-btn__loader").show()):(o.prop("disabled",!1),o.find(".pl-btn__text").show(),o.find(".pl-btn__loader").hide())},showFieldError:function(e){e.addClass("pl-input--error"),e.one("input",function(){n(this).removeClass("pl-input--error")}),e.focus()},showMessage:function(e,t){var o=n("#pl-message");o.text(e).removeClass("pl-message--error pl-message--success").addClass("pl-message--"+t).show(),setTimeout(function(){o.fadeOut(200)},4e3)},isValidEmail:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},escapeHtml:function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}},n(document).ready(function(){i.init()}),window.PasswordlessLogin=i}},function(e){e.O(0,[448],function(){return t=2299,e(e.s=t);var t});e.O()}]);