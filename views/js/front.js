/*! For license information please see front.js.LICENSE.txt */
"use strict";(self.webpackChunkwepresta_passwordless_login=self.webpackChunkwepresta_passwordless_login||[]).push([[440],{2299:function(e,t,o){var n,i;o(8992),o(2577),n=jQuery,i={apiUrl:"",csrfToken:"",googleEnabled:!1,googleClientId:"",resendCountdown:60,backUrl:"",email:"",currentStep:"email",countdownTimer:null,loading:!1,init:function(){var e=n("#passwordless-login");if(e.length){this.apiUrl=e.data("api-url"),this.csrfToken=e.data("csrf-token"),this.googleEnabled=!!e.data("google-enabled"),this.googleClientId=e.data("google-client-id")||"",this.resendCountdown=parseInt(e.data("resend-countdown"),10)||60,this.backUrl=e.data("back-url")||"",this.bindEvents(),this.googleEnabled&&this.googleClientId&&this.initGoogleSignIn();var t=this;n(window).on("popstate",function(e){var o=e.originalEvent.state;o&&o.step&&t.showStep(o.step,!0)}),history.replaceState({step:"email"},"",window.location.href)}},bindEvents:function(){var e=this;n("#pl-email-form").on("submit",function(t){t.preventDefault(),e.sendCode()}),n(document).on("input",".pl-code-digit",function(){e.handleCodeInput(n(this))}),n(document).on("keydown",".pl-code-digit",function(t){e.handleCodeKeydown(n(this),t)}),n(document).on("paste",".pl-code-digit",function(t){t.preventDefault();var o=(t.originalEvent.clipboardData||window.clipboardData).getData("text");e.handleCodePaste(o)}),n("#pl-profile-form").on("submit",function(t){t.preventDefault(),e.completeProfile()}),n("#pl-resend-btn").on("click",function(){n(this).prop("disabled")||e.sendCode()}),n("#pl-back-to-email").on("click",function(){e.showStep("email")}),n("#pl-back-to-code").on("click",function(){e.showStep("code")})},showStep:function(e,t){this.currentStep=e,n(".pl-step").hide(),n('.pl-step[data-step="'+e+'"]').fadeIn(200),n("#pl-code-error").hide(),t||history.pushState({step:e},"",window.location.href),"email"===e?setTimeout(function(){n("#pl-email").focus()},250):"code"===e?setTimeout(function(){n(".pl-code-digit").first().focus()},250):"profile"===e&&setTimeout(function(){n("#pl-firstname").focus()},250)},sendCode:function(){var e=this,t=n.trim(n("#pl-email").val());t&&this.isValidEmail(t)?(this.email=t,this.setLoading("#pl-send-code-btn",!0),n.ajax({url:this.apiUrl,method:"POST",dataType:"json",data:{action:"sendCode",email:t,token:this.csrfToken},success:function(t){if(t.success){n("#pl-code-subtitle").html((n("#pl-code-subtitle").closest(".pl-card").find(".pl-title").text(),e.email));var o=n("#pl-code-subtitle");o.html(o.data("template")||"Code sent to <strong>"+e.escapeHtml(e.email)+"</strong>"),o.html("Code sent to <strong>"+e.escapeHtml(e.email)+"</strong>"),e.showStep("code"),e.clearCodeInputs(),e.startCountdown()}else e.showMessage(t.error||"An error occurred.","error")},error:function(){e.showMessage("An error occurred. Please try again.","error")},complete:function(){e.setLoading("#pl-send-code-btn",!1)}})):this.showFieldError(n("#pl-email"))},handleCodeInput:function(e){var t=e.val().replace(/[^0-9]/g,"");if(e.val(t),1===t.length){e.addClass("pl-code-digit--filled").removeClass("pl-code-digit--error");var o=e.closest(".pl-code-inputs").find('.pl-code-digit[data-index="'+(parseInt(e.data("index"),10)+1)+'"]');o.length&&o.focus()}this.checkCodeComplete()},handleCodeKeydown:function(e,t){if("Backspace"===t.key){if(""===e.val()){var o=e.closest(".pl-code-inputs").find('.pl-code-digit[data-index="'+(parseInt(e.data("index"),10)-1)+'"]');o.length&&o.val("").removeClass("pl-code-digit--filled").focus()}else e.val("").removeClass("pl-code-digit--filled");t.preventDefault()}if("ArrowLeft"===t.key){var n=e.closest(".pl-code-inputs").find('.pl-code-digit[data-index="'+(parseInt(e.data("index"),10)-1)+'"]');n.length&&n.focus()}if("ArrowRight"===t.key){var i=e.closest(".pl-code-inputs").find('.pl-code-digit[data-index="'+(parseInt(e.data("index"),10)+1)+'"]');i.length&&i.focus()}},handleCodePaste:function(e){var t=e.replace(/[^0-9]/g,"").substring(0,6);if(0!==t.length){for(var o=n(".pl-code-digit"),i=0;i<t.length&&i<6;i++)o.eq(i).val(t[i]).addClass("pl-code-digit--filled");t.length<6?o.eq(t.length).focus():(o.eq(5).focus(),this.checkCodeComplete())}},clearCodeInputs:function(){n(".pl-code-digit").val("").removeClass("pl-code-digit--filled pl-code-digit--error")},checkCodeComplete:function(){var e="",t=!0;n(".pl-code-digit").each(function(){var o=n(this).val();1!==o.length&&(t=!1),e+=o}),t&&6===e.length&&this.verifyCode(e)},verifyCode:function(e){var t=this;this.loading||(this.loading=!0,n.ajax({url:this.apiUrl,method:"POST",dataType:"json",data:{action:"verifyCode",email:this.email,code:e,token:this.csrfToken},success:function(e){e.success?e.needsProfile?(e.firstName&&n("#pl-firstname").val(e.firstName),e.lastName&&n("#pl-lastname").val(e.lastName),t.showStep("profile")):(t.showMessage("Logged in successfully!","success"),window.location.href=t.backUrl||e.redirectUrl||window.location.origin):(t.showCodeError(e.error||"Invalid code."),t.clearCodeInputs(),setTimeout(function(){n(".pl-code-digit").first().focus()},100))},error:function(){t.showCodeError("An error occurred. Please try again."),t.clearCodeInputs()},complete:function(){t.loading=!1}}))},showCodeError:function(e){n("#pl-code-error").text(e).show(),n(".pl-code-digit").addClass("pl-code-digit--error")},completeProfile:function(){var e=this,t=n.trim(n("#pl-firstname").val()),o=n.trim(n("#pl-lastname").val());t?o?(this.setLoading("#pl-complete-btn",!0),n.ajax({url:this.apiUrl,method:"POST",dataType:"json",data:{action:"completeProfile",email:this.email,firstname:t,lastname:o,token:this.csrfToken},success:function(t){t.success?(e.showMessage("Account created!","success"),window.location.href=e.backUrl||t.redirectUrl||window.location.origin):e.showMessage(t.error||"An error occurred.","error")},error:function(){e.showMessage("An error occurred. Please try again.","error")},complete:function(){e.setLoading("#pl-complete-btn",!1)}})):this.showFieldError(n("#pl-lastname")):this.showFieldError(n("#pl-firstname"))},initGoogleSignIn:function(){var e=this,t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=function(){"undefined"!=typeof google&&google.accounts&&(google.accounts.id.initialize({client_id:e.googleClientId,callback:function(t){e.handleGoogleAuth(t.credential)}}),n("#pl-google-btn").on("click",function(){google.accounts.id.prompt()}))},document.head.appendChild(t)},handleGoogleAuth:function(e){var t=this;this.setLoading("#pl-google-btn",!0),n.ajax({url:this.apiUrl,method:"POST",dataType:"json",data:{action:"googleAuth",credential:e,token:this.csrfToken},success:function(e){e.success?e.needsProfile?(t.email=e.email||"",e.firstName&&n("#pl-firstname").val(e.firstName),e.lastName&&n("#pl-lastname").val(e.lastName),t.showStep("profile")):(t.showMessage("Logged in successfully!","success"),window.location.href=t.backUrl||e.redirectUrl||window.location.origin):t.showMessage(e.error||"Google authentication failed.","error")},error:function(){t.showMessage("An error occurred. Please try again.","error")},complete:function(){t.setLoading("#pl-google-btn",!1)}})},startCountdown:function(){var e=this,t=this.resendCountdown,o=n("#pl-resend-btn"),i=n("#pl-countdown"),s=n("#pl-countdown-wrap");o.prop("disabled",!0),s.show(),this.countdownTimer&&clearInterval(this.countdownTimer);var a=function(){var e=Math.floor(t/60),o=t%60;i.text(e+":"+(o<10?"0":"")+o)};a(),this.countdownTimer=setInterval(function(){--t<=0?(clearInterval(e.countdownTimer),o.prop("disabled",!1),s.hide()):a()},1e3)},setLoading:function(e,t){var o=n(e);t?(o.prop("disabled",!0),o.find(".pl-btn__text").hide(),o.find(".pl-btn__loader").show()):(o.prop("disabled",!1),o.find(".pl-btn__text").show(),o.find(".pl-btn__loader").hide())},showFieldError:function(e){e.addClass("pl-input--error"),e.one("input",function(){n(this).removeClass("pl-input--error")}),e.focus()},showMessage:function(e,t){var o=n("#pl-message");o.text(e).removeClass("pl-message--error pl-message--success").addClass("pl-message--"+t).show(),setTimeout(function(){o.fadeOut(200)},4e3)},isValidEmail:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},escapeHtml:function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}},n(document).ready(function(){i.init()}),window.PasswordlessLogin=i}},function(e){e.O(0,[448],function(){return e(e.s=2299)}),e.O()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQUtDLFFBQVEsSUFDakIsRUFBRyxJQUNQLEVBRUFwRixhQUFjLFNBQVU1QyxHQUNwQixNQUFPLDZCQUE2QmlJLEtBQUtqSSxFQUM3QyxFQUVBMkQsV0FBWSxTQUFVdUUsR0FDbEIsSUFBSUMsRUFBTXpHLFNBQVNzRSxjQUFjLE9BRWpDLE9BREFtQyxFQUFJcEIsWUFBWXJGLFNBQVMwRyxlQUFlRixJQUNqQ0MsRUFBSUUsU0FDZixHQUdKOUksRUFBRW1DLFVBQVU0RyxNQUFNLFdBQ2Q5SSxFQUFrQlksTUFDdEIsR0FFQVMsT0FBT3JCLGtCQUFvQkEsQyIsInNvdXJjZXMiOlsid2VicGFjazovL3dlcHJlc3RhX3Bhc3N3b3JkbGVzc19sb2dpbi8uL19kZXYvanMvZnJvbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQYXNzd29yZGxlc3MgTG9naW4gLSBGcm9udC1vZmZpY2UgSmF2YVNjcmlwdFxuICogalF1ZXJ5LWJhc2VkIG11bHRpLXN0ZXAgYXV0aGVudGljYXRpb24gZmxvd1xuICovXG5cbmltcG9ydCAnLi4vc2Nzcy9mcm9udC5zY3NzJztcblxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIFBhc3N3b3JkbGVzc0xvZ2luID0ge1xuICAgICAgICBhcGlVcmw6ICcnLFxuICAgICAgICBjc3JmVG9rZW46ICcnLFxuICAgICAgICBnb29nbGVFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgZ29vZ2xlQ2xpZW50SWQ6ICcnLFxuICAgICAgICByZXNlbmRDb3VudGRvd246IDYwLFxuICAgICAgICBiYWNrVXJsOiAnJyxcbiAgICAgICAgZW1haWw6ICcnLFxuICAgICAgICBjdXJyZW50U3RlcDogJ2VtYWlsJyxcbiAgICAgICAgY291bnRkb3duVGltZXI6IG51bGwsXG4gICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciAkY29udGFpbmVyID0gJCgnI3Bhc3N3b3JkbGVzcy1sb2dpbicpO1xuICAgICAgICAgICAgaWYgKCEkY29udGFpbmVyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5hcGlVcmwgPSAkY29udGFpbmVyLmRhdGEoJ2FwaS11cmwnKTtcbiAgICAgICAgICAgIHRoaXMuY3NyZlRva2VuID0gJGNvbnRhaW5lci5kYXRhKCdjc3JmLXRva2VuJyk7XG4gICAgICAgICAgICB0aGlzLmdvb2dsZUVuYWJsZWQgPSAhISRjb250YWluZXIuZGF0YSgnZ29vZ2xlLWVuYWJsZWQnKTtcbiAgICAgICAgICAgIHRoaXMuZ29vZ2xlQ2xpZW50SWQgPSAkY29udGFpbmVyLmRhdGEoJ2dvb2dsZS1jbGllbnQtaWQnKSB8fCAnJztcbiAgICAgICAgICAgIHRoaXMucmVzZW5kQ291bnRkb3duID0gcGFyc2VJbnQoJGNvbnRhaW5lci5kYXRhKCdyZXNlbmQtY291bnRkb3duJyksIDEwKSB8fCA2MDtcbiAgICAgICAgICAgIHRoaXMuYmFja1VybCA9ICRjb250YWluZXIuZGF0YSgnYmFjay11cmwnKSB8fCAnJztcblxuICAgICAgICAgICAgdGhpcy5iaW5kRXZlbnRzKCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmdvb2dsZUVuYWJsZWQgJiYgdGhpcy5nb29nbGVDbGllbnRJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5pdEdvb2dsZVNpZ25JbigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBIYW5kbGUgYnJvd3NlciBiYWNrIGJ1dHRvblxuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdwb3BzdGF0ZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gZS5vcmlnaW5hbEV2ZW50LnN0YXRlO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5zdGVwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd1N0ZXAoc3RhdGUuc3RlcCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFB1c2ggaW5pdGlhbCBzdGF0ZVxuICAgICAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoeyBzdGVwOiAnZW1haWwnIH0sICcnLCB3aW5kb3cubG9jYXRpb24uaHJlZik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmluZEV2ZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICAvLyBFbWFpbCBmb3JtXG4gICAgICAgICAgICAkKCcjcGwtZW1haWwtZm9ybScpLm9uKCdzdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNlbmRDb2RlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gQ29kZSBkaWdpdCBpbnB1dHNcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKCdpbnB1dCcsICcucGwtY29kZS1kaWdpdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZUNvZGVJbnB1dCgkKHRoaXMpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbigna2V5ZG93bicsICcucGwtY29kZS1kaWdpdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVDb2RlS2V5ZG93bigkKHRoaXMpLCBlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbigncGFzdGUnLCAnLnBsLWNvZGUtZGlnaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgcGFzdGVkRGF0YSA9IChlLm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YSB8fCB3aW5kb3cuY2xpcGJvYXJkRGF0YSkuZ2V0RGF0YSgndGV4dCcpO1xuICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlQ29kZVBhc3RlKHBhc3RlZERhdGEpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFByb2ZpbGUgZm9ybVxuICAgICAgICAgICAgJCgnI3BsLXByb2ZpbGUtZm9ybScpLm9uKCdzdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBzZWxmLmNvbXBsZXRlUHJvZmlsZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFJlc2VuZCBjb2RlXG4gICAgICAgICAgICAkKCcjcGwtcmVzZW5kLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoISQodGhpcykucHJvcCgnZGlzYWJsZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRDb2RlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIEJhY2sgYnV0dG9uc1xuICAgICAgICAgICAgJCgnI3BsLWJhY2stdG8tZW1haWwnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zaG93U3RlcCgnZW1haWwnKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKCcjcGwtYmFjay10by1jb2RlJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYuc2hvd1N0ZXAoJ2NvZGUnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIFN0ZXAgbWFuYWdlbWVudFxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgICAgIHNob3dTdGVwOiBmdW5jdGlvbiAoc3RlcCwgZnJvbVBvcHN0YXRlKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTdGVwID0gc3RlcDtcblxuICAgICAgICAgICAgJCgnLnBsLXN0ZXAnKS5oaWRlKCk7XG4gICAgICAgICAgICAkKCcucGwtc3RlcFtkYXRhLXN0ZXA9XCInICsgc3RlcCArICdcIl0nKS5mYWRlSW4oMjAwKTtcblxuICAgICAgICAgICAgLy8gSGlkZSBhbnkgZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgICAgICQoJyNwbC1jb2RlLWVycm9yJykuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoIWZyb21Qb3BzdGF0ZSkge1xuICAgICAgICAgICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKHsgc3RlcDogc3RlcCB9LCAnJywgd2luZG93LmxvY2F0aW9uLmhyZWYpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGb2N1cyBtYW5hZ2VtZW50XG4gICAgICAgICAgICBpZiAoc3RlcCA9PT0gJ2VtYWlsJykge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyAkKCcjcGwtZW1haWwnKS5mb2N1cygpOyB9LCAyNTApO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzdGVwID09PSAnY29kZScpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgJCgnLnBsLWNvZGUtZGlnaXQnKS5maXJzdCgpLmZvY3VzKCk7IH0sIDI1MCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHN0ZXAgPT09ICdwcm9maWxlJykge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyAkKCcjcGwtZmlyc3RuYW1lJykuZm9jdXMoKTsgfSwgMjUwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBTZW5kIGNvZGVcbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgICAgICBzZW5kQ29kZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGVtYWlsID0gJC50cmltKCQoJyNwbC1lbWFpbCcpLnZhbCgpKTtcblxuICAgICAgICAgICAgaWYgKCFlbWFpbCB8fCAhdGhpcy5pc1ZhbGlkRW1haWwoZW1haWwpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93RmllbGRFcnJvcigkKCcjcGwtZW1haWwnKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmVtYWlsID0gZW1haWw7XG4gICAgICAgICAgICB0aGlzLnNldExvYWRpbmcoJyNwbC1zZW5kLWNvZGUtYnRuJywgdHJ1ZSk7XG5cbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLmFwaVVybCxcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnc2VuZENvZGUnLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiB0aGlzLmNzcmZUb2tlblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTaG93IGNvZGUgc3RlcFxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3BsLWNvZGUtc3VidGl0bGUnKS5odG1sKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNwbC1jb2RlLXN1YnRpdGxlJykuY2xvc2VzdCgnLnBsLWNhcmQnKS5maW5kKCcucGwtdGl0bGUnKS50ZXh0KCkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZW1haWwgOiBzZWxmLmVtYWlsXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHN1YnRpdGxlIHdpdGggdGhlIGVtYWlsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJHN1YnRpdGxlID0gJCgnI3BsLWNvZGUtc3VidGl0bGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdWJ0aXRsZS5odG1sKCRzdWJ0aXRsZS5kYXRhKCd0ZW1wbGF0ZScpIHx8ICgnQ29kZSBzZW50IHRvIDxzdHJvbmc+JyArIHNlbGYuZXNjYXBlSHRtbChzZWxmLmVtYWlsKSArICc8L3N0cm9uZz4nKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBY3R1YWxseSBqdXN0IHNldCBpdCBkaXJlY3RseVxuICAgICAgICAgICAgICAgICAgICAgICAgJHN1YnRpdGxlLmh0bWwoJ0NvZGUgc2VudCB0byA8c3Ryb25nPicgKyBzZWxmLmVzY2FwZUh0bWwoc2VsZi5lbWFpbCkgKyAnPC9zdHJvbmc+Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd1N0ZXAoJ2NvZGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2xlYXJDb2RlSW5wdXRzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0Q291bnRkb3duKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dNZXNzYWdlKHJlc3BvbnNlLmVycm9yIHx8ICdBbiBlcnJvciBvY2N1cnJlZC4nLCAnZXJyb3InKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93TWVzc2FnZSgnQW4gZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4uJywgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnNldExvYWRpbmcoJyNwbC1zZW5kLWNvZGUtYnRuJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIENvZGUgaW5wdXQgaGFuZGxpbmdcbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgICAgICBoYW5kbGVDb2RlSW5wdXQ6IGZ1bmN0aW9uICgkaW5wdXQpIHtcbiAgICAgICAgICAgIHZhciB2YWwgPSAkaW5wdXQudmFsKCkucmVwbGFjZSgvW14wLTldL2csICcnKTtcbiAgICAgICAgICAgICRpbnB1dC52YWwodmFsKTtcblxuICAgICAgICAgICAgaWYgKHZhbC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAkaW5wdXQuYWRkQ2xhc3MoJ3BsLWNvZGUtZGlnaXQtLWZpbGxlZCcpLnJlbW92ZUNsYXNzKCdwbC1jb2RlLWRpZ2l0LS1lcnJvcicpO1xuICAgICAgICAgICAgICAgIC8vIE1vdmUgdG8gbmV4dCBpbnB1dFxuICAgICAgICAgICAgICAgIHZhciAkbmV4dCA9ICRpbnB1dC5jbG9zZXN0KCcucGwtY29kZS1pbnB1dHMnKS5maW5kKCcucGwtY29kZS1kaWdpdFtkYXRhLWluZGV4PVwiJyArIChwYXJzZUludCgkaW5wdXQuZGF0YSgnaW5kZXgnKSwgMTApICsgMSkgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgaWYgKCRuZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkbmV4dC5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYWxsIDYgZGlnaXRzIGFyZSBmaWxsZWRcbiAgICAgICAgICAgIHRoaXMuY2hlY2tDb2RlQ29tcGxldGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBoYW5kbGVDb2RlS2V5ZG93bjogZnVuY3Rpb24gKCRpbnB1dCwgZSkge1xuICAgICAgICAgICAgLy8gQmFja3NwYWNlOiBjbGVhciBhbmQgbW92ZSB0byBwcmV2aW91c1xuICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnQmFja3NwYWNlJykge1xuICAgICAgICAgICAgICAgIGlmICgkaW5wdXQudmFsKCkgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkcHJldiA9ICRpbnB1dC5jbG9zZXN0KCcucGwtY29kZS1pbnB1dHMnKS5maW5kKCcucGwtY29kZS1kaWdpdFtkYXRhLWluZGV4PVwiJyArIChwYXJzZUludCgkaW5wdXQuZGF0YSgnaW5kZXgnKSwgMTApIC0gMSkgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICgkcHJldi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRwcmV2LnZhbCgnJykucmVtb3ZlQ2xhc3MoJ3BsLWNvZGUtZGlnaXQtLWZpbGxlZCcpLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkaW5wdXQudmFsKCcnKS5yZW1vdmVDbGFzcygncGwtY29kZS1kaWdpdC0tZmlsbGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQXJyb3cgbGVmdFxuICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnQXJyb3dMZWZ0Jykge1xuICAgICAgICAgICAgICAgIHZhciAkcHJldkFycm93ID0gJGlucHV0LmNsb3Nlc3QoJy5wbC1jb2RlLWlucHV0cycpLmZpbmQoJy5wbC1jb2RlLWRpZ2l0W2RhdGEtaW5kZXg9XCInICsgKHBhcnNlSW50KCRpbnB1dC5kYXRhKCdpbmRleCcpLCAxMCkgLSAxKSArICdcIl0nKTtcbiAgICAgICAgICAgICAgICBpZiAoJHByZXZBcnJvdy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgJHByZXZBcnJvdy5mb2N1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQXJyb3cgcmlnaHRcbiAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0Fycm93UmlnaHQnKSB7XG4gICAgICAgICAgICAgICAgdmFyICRuZXh0QXJyb3cgPSAkaW5wdXQuY2xvc2VzdCgnLnBsLWNvZGUtaW5wdXRzJykuZmluZCgnLnBsLWNvZGUtZGlnaXRbZGF0YS1pbmRleD1cIicgKyAocGFyc2VJbnQoJGlucHV0LmRhdGEoJ2luZGV4JyksIDEwKSArIDEpICsgJ1wiXScpO1xuICAgICAgICAgICAgICAgIGlmICgkbmV4dEFycm93Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkbmV4dEFycm93LmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhhbmRsZUNvZGVQYXN0ZTogZnVuY3Rpb24gKHBhc3RlZERhdGEpIHtcbiAgICAgICAgICAgIHZhciBkaWdpdHMgPSBwYXN0ZWREYXRhLnJlcGxhY2UoL1teMC05XS9nLCAnJykuc3Vic3RyaW5nKDAsIDYpO1xuICAgICAgICAgICAgaWYgKGRpZ2l0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciAkaW5wdXRzID0gJCgnLnBsLWNvZGUtZGlnaXQnKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGlnaXRzLmxlbmd0aCAmJiBpIDwgNjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgJGlucHV0cy5lcShpKS52YWwoZGlnaXRzW2ldKS5hZGRDbGFzcygncGwtY29kZS1kaWdpdC0tZmlsbGVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZvY3VzIHRoZSBuZXh0IGVtcHR5IGlucHV0IG9yIHRoZSBsYXN0IG9uZVxuICAgICAgICAgICAgaWYgKGRpZ2l0cy5sZW5ndGggPCA2KSB7XG4gICAgICAgICAgICAgICAgJGlucHV0cy5lcShkaWdpdHMubGVuZ3RoKS5mb2N1cygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkaW5wdXRzLmVxKDUpLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja0NvZGVDb21wbGV0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFyQ29kZUlucHV0czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCgnLnBsLWNvZGUtZGlnaXQnKS52YWwoJycpLnJlbW92ZUNsYXNzKCdwbC1jb2RlLWRpZ2l0LS1maWxsZWQgcGwtY29kZS1kaWdpdC0tZXJyb3InKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja0NvZGVDb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNvZGUgPSAnJztcbiAgICAgICAgICAgIHZhciBhbGxGaWxsZWQgPSB0cnVlO1xuICAgICAgICAgICAgJCgnLnBsLWNvZGUtZGlnaXQnKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBhbGxGaWxsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29kZSArPSB2YWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGFsbEZpbGxlZCAmJiBjb2RlLmxlbmd0aCA9PT0gNikge1xuICAgICAgICAgICAgICAgIHRoaXMudmVyaWZ5Q29kZShjb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBWZXJpZnkgY29kZVxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgICAgIHZlcmlmeUNvZGU6IGZ1bmN0aW9uIChjb2RlKSB7XG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogdGhpcy5hcGlVcmwsXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3ZlcmlmeUNvZGUnLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgY29kZTogY29kZSxcbiAgICAgICAgICAgICAgICAgICAgdG9rZW46IHRoaXMuY3NyZlRva2VuXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5uZWVkc1Byb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOZXcgdXNlcjogc2hvdyBwcm9maWxlIHN0ZXBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmUtZmlsbCBpZiBkYXRhIGZyb20gR29vZ2xlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmZpcnN0TmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGwtZmlyc3RuYW1lJykudmFsKHJlc3BvbnNlLmZpcnN0TmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5sYXN0TmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGwtbGFzdG5hbWUnKS52YWwocmVzcG9uc2UubGFzdE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dTdGVwKCdwcm9maWxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4aXN0aW5nIHVzZXI6IHJlZGlyZWN0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93TWVzc2FnZSgnTG9nZ2VkIGluIHN1Y2Nlc3NmdWxseSEnLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gc2VsZi5iYWNrVXJsIHx8IHJlc3BvbnNlLnJlZGlyZWN0VXJsIHx8IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dDb2RlRXJyb3IocmVzcG9uc2UuZXJyb3IgfHwgJ0ludmFsaWQgY29kZS4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2xlYXJDb2RlSW5wdXRzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgJCgnLnBsLWNvZGUtZGlnaXQnKS5maXJzdCgpLmZvY3VzKCk7IH0sIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd0NvZGVFcnJvcignQW4gZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4uJyk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY2xlYXJDb2RlSW5wdXRzKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzaG93Q29kZUVycm9yOiBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgdmFyICRlcnJvciA9ICQoJyNwbC1jb2RlLWVycm9yJyk7XG4gICAgICAgICAgICAkZXJyb3IudGV4dChtZXNzYWdlKS5zaG93KCk7XG4gICAgICAgICAgICAkKCcucGwtY29kZS1kaWdpdCcpLmFkZENsYXNzKCdwbC1jb2RlLWRpZ2l0LS1lcnJvcicpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIENvbXBsZXRlIHByb2ZpbGVcbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgICAgICBjb21wbGV0ZVByb2ZpbGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIHZhciBmaXJzdE5hbWUgPSAkLnRyaW0oJCgnI3BsLWZpcnN0bmFtZScpLnZhbCgpKTtcbiAgICAgICAgICAgIHZhciBsYXN0TmFtZSA9ICQudHJpbSgkKCcjcGwtbGFzdG5hbWUnKS52YWwoKSk7XG5cbiAgICAgICAgICAgIGlmICghZmlyc3ROYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93RmllbGRFcnJvcigkKCcjcGwtZmlyc3RuYW1lJykpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghbGFzdE5hbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dGaWVsZEVycm9yKCQoJyNwbC1sYXN0bmFtZScpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2V0TG9hZGluZygnI3BsLWNvbXBsZXRlLWJ0bicsIHRydWUpO1xuXG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogdGhpcy5hcGlVcmwsXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2NvbXBsZXRlUHJvZmlsZScsXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgICBmaXJzdG5hbWU6IGZpcnN0TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgbGFzdG5hbWU6IGxhc3ROYW1lLFxuICAgICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy5jc3JmVG9rZW5cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93TWVzc2FnZSgnQWNjb3VudCBjcmVhdGVkIScsICdzdWNjZXNzJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHNlbGYuYmFja1VybCB8fCByZXNwb25zZS5yZWRpcmVjdFVybCB8fCB3aW5kb3cubG9jYXRpb24ub3JpZ2luO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93TWVzc2FnZShyZXNwb25zZS5lcnJvciB8fCAnQW4gZXJyb3Igb2NjdXJyZWQuJywgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd01lc3NhZ2UoJ0FuIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluLicsICdlcnJvcicpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRMb2FkaW5nKCcjcGwtY29tcGxldGUtYnRuJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAgIC8vIEdvb2dsZSBTaWduLUluXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAgICAgaW5pdEdvb2dsZVNpZ25JbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgICAgICAgc2NyaXB0LnNyYyA9ICdodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vZ3NpL2NsaWVudCc7XG4gICAgICAgICAgICBzY3JpcHQuYXN5bmMgPSB0cnVlO1xuICAgICAgICAgICAgc2NyaXB0LmRlZmVyID0gdHJ1ZTtcbiAgICAgICAgICAgIHNjcmlwdC5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBnb29nbGUgIT09ICd1bmRlZmluZWQnICYmIGdvb2dsZS5hY2NvdW50cykge1xuICAgICAgICAgICAgICAgICAgICBnb29nbGUuYWNjb3VudHMuaWQuaW5pdGlhbGl6ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRfaWQ6IHNlbGYuZ29vZ2xlQ2xpZW50SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVHb29nbGVBdXRoKHJlc3BvbnNlLmNyZWRlbnRpYWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBSZW5kZXIgYSBjdXN0b20gYnV0dG9uIGhhbmRsZXJcbiAgICAgICAgICAgICAgICAgICAgJCgnI3BsLWdvb2dsZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnb29nbGUuYWNjb3VudHMuaWQucHJvbXB0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGFuZGxlR29vZ2xlQXV0aDogZnVuY3Rpb24gKGNyZWRlbnRpYWwpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAgICAgdGhpcy5zZXRMb2FkaW5nKCcjcGwtZ29vZ2xlLWJ0bicsIHRydWUpO1xuXG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogdGhpcy5hcGlVcmwsXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2dvb2dsZUF1dGgnLFxuICAgICAgICAgICAgICAgICAgICBjcmVkZW50aWFsOiBjcmVkZW50aWFsLFxuICAgICAgICAgICAgICAgICAgICB0b2tlbjogdGhpcy5jc3JmVG9rZW5cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm5lZWRzUHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZW1haWwgPSByZXNwb25zZS5lbWFpbCB8fCAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZmlyc3ROYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNwbC1maXJzdG5hbWUnKS52YWwocmVzcG9uc2UuZmlyc3ROYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxhc3ROYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNwbC1sYXN0bmFtZScpLnZhbChyZXNwb25zZS5sYXN0TmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd1N0ZXAoJ3Byb2ZpbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93TWVzc2FnZSgnTG9nZ2VkIGluIHN1Y2Nlc3NmdWxseSEnLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gc2VsZi5iYWNrVXJsIHx8IHJlc3BvbnNlLnJlZGlyZWN0VXJsIHx8IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dNZXNzYWdlKHJlc3BvbnNlLmVycm9yIHx8ICdHb29nbGUgYXV0aGVudGljYXRpb24gZmFpbGVkLicsICdlcnJvcicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dNZXNzYWdlKCdBbiBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2Fpbi4nLCAnZXJyb3InKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0TG9hZGluZygnI3BsLWdvb2dsZS1idG4nLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgICAgLy8gQ291bnRkb3duIHRpbWVyXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAgICAgc3RhcnRDb3VudGRvd246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIHZhciBzZWNvbmRzID0gdGhpcy5yZXNlbmRDb3VudGRvd247XG4gICAgICAgICAgICB2YXIgJGJ0biA9ICQoJyNwbC1yZXNlbmQtYnRuJyk7XG4gICAgICAgICAgICB2YXIgJGNvdW50ZG93biA9ICQoJyNwbC1jb3VudGRvd24nKTtcbiAgICAgICAgICAgIHZhciAkd3JhcCA9ICQoJyNwbC1jb3VudGRvd24td3JhcCcpO1xuXG4gICAgICAgICAgICAkYnRuLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAkd3JhcC5zaG93KCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvdW50ZG93blRpbWVyKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNvdW50ZG93blRpbWVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHVwZGF0ZURpc3BsYXkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1pbnMgPSBNYXRoLmZsb29yKHNlY29uZHMgLyA2MCk7XG4gICAgICAgICAgICAgICAgdmFyIHNlY3MgPSBzZWNvbmRzICUgNjA7XG4gICAgICAgICAgICAgICAgJGNvdW50ZG93bi50ZXh0KG1pbnMgKyAnOicgKyAoc2VjcyA8IDEwID8gJzAnIDogJycpICsgc2Vjcyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB1cGRhdGVEaXNwbGF5KCk7XG5cbiAgICAgICAgICAgIHRoaXMuY291bnRkb3duVGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2Vjb25kcy0tO1xuICAgICAgICAgICAgICAgIGlmIChzZWNvbmRzIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChzZWxmLmNvdW50ZG93blRpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgJGJ0bi5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgJHdyYXAuaGlkZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZURpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgICAvLyBVdGlsaXRpZXNcbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgICAgICBzZXRMb2FkaW5nOiBmdW5jdGlvbiAoc2VsZWN0b3IsIGlzTG9hZGluZykge1xuICAgICAgICAgICAgdmFyICRidG4gPSAkKHNlbGVjdG9yKTtcbiAgICAgICAgICAgIGlmIChpc0xvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAkYnRuLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgJGJ0bi5maW5kKCcucGwtYnRuX190ZXh0JykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICRidG4uZmluZCgnLnBsLWJ0bl9fbG9hZGVyJykuc2hvdygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkYnRuLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICRidG4uZmluZCgnLnBsLWJ0bl9fdGV4dCcpLnNob3coKTtcbiAgICAgICAgICAgICAgICAkYnRuLmZpbmQoJy5wbC1idG5fX2xvYWRlcicpLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzaG93RmllbGRFcnJvcjogZnVuY3Rpb24gKCRpbnB1dCkge1xuICAgICAgICAgICAgJGlucHV0LmFkZENsYXNzKCdwbC1pbnB1dC0tZXJyb3InKTtcbiAgICAgICAgICAgICRpbnB1dC5vbmUoJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ3BsLWlucHV0LS1lcnJvcicpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzaG93TWVzc2FnZTogZnVuY3Rpb24gKHRleHQsIHR5cGUpIHtcbiAgICAgICAgICAgIHZhciAkbXNnID0gJCgnI3BsLW1lc3NhZ2UnKTtcbiAgICAgICAgICAgICRtc2cudGV4dCh0ZXh0KVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygncGwtbWVzc2FnZS0tZXJyb3IgcGwtbWVzc2FnZS0tc3VjY2VzcycpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKCdwbC1tZXNzYWdlLS0nICsgdHlwZSlcbiAgICAgICAgICAgICAgICAuc2hvdygpO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkbXNnLmZhZGVPdXQoMjAwKTtcbiAgICAgICAgICAgIH0sIDQwMDApO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzVmFsaWRFbWFpbDogZnVuY3Rpb24gKGVtYWlsKSB7XG4gICAgICAgICAgICByZXR1cm4gL15bXlxcc0BdK0BbXlxcc0BdK1xcLlteXFxzQF0rJC8udGVzdChlbWFpbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXNjYXBlSHRtbDogZnVuY3Rpb24gKHN0cikge1xuICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHN0cikpO1xuICAgICAgICAgICAgcmV0dXJuIGRpdi5pbm5lckhUTUw7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICBQYXNzd29yZGxlc3NMb2dpbi5pbml0KCk7XG4gICAgfSk7XG5cbiAgICB3aW5kb3cuUGFzc3dvcmRsZXNzTG9naW4gPSBQYXNzd29yZGxlc3NMb2dpbjtcblxufSkoalF1ZXJ5KTtcblxuIl0sIm5hbWVzIjpbIiQiLCJQYXNzd29yZGxlc3NMb2dpbiIsImpRdWVyeSIsImFwaVVybCIsImNzcmZUb2tlbiIsImdvb2dsZUVuYWJsZWQiLCJnb29nbGVDbGllbnRJZCIsInJlc2VuZENvdW50ZG93biIsImJhY2tVcmwiLCJlbWFpbCIsImN1cnJlbnRTdGVwIiwiY291bnRkb3duVGltZXIiLCJsb2FkaW5nIiwiaW5pdCIsIiRjb250YWluZXIiLCJsZW5ndGgiLCJ0aGlzIiwiZGF0YSIsInBhcnNlSW50IiwiYmluZEV2ZW50cyIsImluaXRHb29nbGVTaWduSW4iLCJzZWxmIiwid2luZG93Iiwib24iLCJlIiwic3RhdGUiLCJvcmlnaW5hbEV2ZW50Iiwic3RlcCIsInNob3dTdGVwIiwiaGlzdG9yeSIsInJlcGxhY2VTdGF0ZSIsImxvY2F0aW9uIiwiaHJlZiIsInByZXZlbnREZWZhdWx0Iiwic2VuZENvZGUiLCJkb2N1bWVudCIsImhhbmRsZUNvZGVJbnB1dCIsImhhbmRsZUNvZGVLZXlkb3duIiwicGFzdGVkRGF0YSIsImNsaXBib2FyZERhdGEiLCJnZXREYXRhIiwiaGFuZGxlQ29kZVBhc3RlIiwiY29tcGxldGVQcm9maWxlIiwicHJvcCIsImZyb21Qb3BzdGF0ZSIsImhpZGUiLCJmYWRlSW4iLCJwdXNoU3RhdGUiLCJzZXRUaW1lb3V0IiwiZm9jdXMiLCJmaXJzdCIsInRyaW0iLCJ2YWwiLCJpc1ZhbGlkRW1haWwiLCJzZXRMb2FkaW5nIiwiYWpheCIsInVybCIsIm1ldGhvZCIsImRhdGFUeXBlIiwiYWN0aW9uIiwidG9rZW4iLCJzdWNjZXNzIiwicmVzcG9uc2UiLCJodG1sIiwiY2xvc2VzdCIsImZpbmQiLCJ0ZXh0IiwiJHN1YnRpdGxlIiwiZXNjYXBlSHRtbCIsImNsZWFyQ29kZUlucHV0cyIsInN0YXJ0Q291bnRkb3duIiwic2hvd01lc3NhZ2UiLCJlcnJvciIsImNvbXBsZXRlIiwic2hvd0ZpZWxkRXJyb3IiLCIkaW5wdXQiLCJyZXBsYWNlIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsIiRuZXh0IiwiY2hlY2tDb2RlQ29tcGxldGUiLCJrZXkiLCIkcHJldiIsIiRwcmV2QXJyb3ciLCIkbmV4dEFycm93IiwiZGlnaXRzIiwic3Vic3RyaW5nIiwiJGlucHV0cyIsImkiLCJlcSIsImNvZGUiLCJhbGxGaWxsZWQiLCJlYWNoIiwidmVyaWZ5Q29kZSIsIm5lZWRzUHJvZmlsZSIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwicmVkaXJlY3RVcmwiLCJvcmlnaW4iLCJzaG93Q29kZUVycm9yIiwibWVzc2FnZSIsInNob3ciLCJmaXJzdG5hbWUiLCJsYXN0bmFtZSIsInNjcmlwdCIsImNyZWF0ZUVsZW1lbnQiLCJzcmMiLCJhc3luYyIsImRlZmVyIiwib25sb2FkIiwiZ29vZ2xlIiwiYWNjb3VudHMiLCJpZCIsImluaXRpYWxpemUiLCJjbGllbnRfaWQiLCJjYWxsYmFjayIsImhhbmRsZUdvb2dsZUF1dGgiLCJjcmVkZW50aWFsIiwicHJvbXB0IiwiaGVhZCIsImFwcGVuZENoaWxkIiwic2Vjb25kcyIsIiRidG4iLCIkY291bnRkb3duIiwiJHdyYXAiLCJjbGVhckludGVydmFsIiwidXBkYXRlRGlzcGxheSIsIm1pbnMiLCJNYXRoIiwiZmxvb3IiLCJzZWNzIiwic2V0SW50ZXJ2YWwiLCJzZWxlY3RvciIsImlzTG9hZGluZyIsIm9uZSIsInR5cGUiLCIkbXNnIiwiZmFkZU91dCIsInRlc3QiLCJzdHIiLCJkaXYiLCJjcmVhdGVUZXh0Tm9kZSIsImlubmVySFRNTCIsInJlYWR5Il0sInNvdXJjZVJvb3QiOiIifQ==