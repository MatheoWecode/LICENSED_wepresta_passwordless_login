---
description: Chemins des assets - ConformitÃ© PrestaShop Addons
globs: ["webpack.config.js", "_dev/**", "views/**"]
alwaysApply: true
---

# Assets Paths - PrestaShop Addons Compliance

## âš ï¸ RÃ¨gle Obligatoire

**Ne JAMAIS compiler les assets dans `/views/dist/`.**

PrestaShop Addons exige que :
- Les fichiers **JavaScript** soient dans `/views/js/`
- Les fichiers **CSS** soient dans `/views/css/`
- Les fichiers **images** soient dans `/views/img/`

## Configuration Webpack Encore

```javascript
// webpack.config.js - Configuration OBLIGATOIRE
Encore
    .setOutputPath('views/js/')                          // JS dans views/js/
    .setPublicPath('/modules/modulestarter/views/js')

    .configureMiniCssExtractPlugin(
        (loaderOptions) => {},
        (pluginOptions) => {
            pluginOptions.filename = '../css/[name].css'; // CSS dans views/css/
        }
    )
    .copyFiles({
        from: './_dev/images',
        to: '../img/[path][name].[hash:8].[ext]',        // Images dans views/img/
        pattern: /\.(png|jpg|jpeg|gif|ico|svg|webp)$/
    })
```

## Structure Attendue

```
views/
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ admin.js         â† Webpack output JS
â”‚   â”œâ”€â”€ front.js         â† Autres JS
â”‚   â”œâ”€â”€ runtime.js       â† Runtime Webpack
â”‚   â”œâ”€â”€ admin.abc123.js  â† Versioning (prod)
â”‚   â”œâ”€â”€ manifest.json    â† Cache busting
â”‚   â””â”€â”€ index.php        â† SÃ©curitÃ©
â”‚
â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ admin.css        â† Webpack output CSS
â”‚   â”œâ”€â”€ front.css        â† Autres CSS
â”‚   â”œâ”€â”€ admin.abc123.css â† Versioning (prod)
â”‚   â””â”€â”€ index.php        â† SÃ©curitÃ©
â”‚
â”œâ”€â”€ img/
â”‚   â”œâ”€â”€ logo.png
â”‚   â”œâ”€â”€ icon.svg
â”‚   â””â”€â”€ [images compilÃ©es]
â”‚
â””â”€â”€ templates/
    â”œâ”€â”€ admin/
    â”‚   â””â”€â”€ dashboard.html.twig
    â””â”€â”€ hook/
        â””â”€â”€ home.tpl
```

## âœ… Webpack Configuration ComplÃ¨te

```javascript
// webpack.config.js - Template valide
const Encore = require('@symfony/webpack-encore');
const path = require('path');

if (!Encore.isRuntimeEnvironmentConfigured()) {
    Encore.configureRuntimeEnvironment(process.env.NODE_ENV || 'dev');
}

Encore
    // â­ CRITIQUE: Output JS dans views/js/
    .setOutputPath('views/js/')
    .setPublicPath('/modules/modulestarter/views/js')
    .setManifestKeyPrefix('modulestarter')

    // Entries
    .addEntry('front', './_dev/js/front.js')
    .addEntry('admin', './_dev/js/admin.js')

    // Features
    .splitEntryChunks()
    .enableSingleRuntimeChunk()
    .cleanupOutputBeforeBuild()
    .enableBuildNotifications()
    .enableSourceMaps(!Encore.isProduction())
    .enableVersioning(Encore.isProduction())

    // Build configuration
    .configureBabel((config) => {
        config.plugins.push('@babel/plugin-proposal-class-properties');
    })
    .configureBabelPresetEnv((config) => {
        config.useBuiltIns = 'usage';
        config.corejs = '3.36';
    })

    // â­ CRITIQUE: CSS vers views/css/
    .enableSassLoader()
    .configureMiniCssExtractPlugin(
        (loaderOptions) => {},
        (pluginOptions) => {
            pluginOptions.filename = '../css/[name].css';
        }
    )

    // PostCSS + Autoprefixer
    .enablePostCssLoader((config) => {
        config.postcssOptions = {
            plugins: [require('autoprefixer')],
        };
    })

    // â­ CRITIQUE: Images vers views/img/
    .copyFiles({
        from: './_dev/images',
        to: '../img/[path][name].[hash:8].[ext]',
        pattern: /\.(png|jpg|jpeg|gif|ico|svg|webp)$/
    })

    // Aliases
    .addAliases({
        '@': path.resolve(__dirname, '_dev/js'),
        '@scss': path.resolve(__dirname, '_dev/scss'),
    });

module.exports = Encore.getWebpackConfig();
```

## âŒ Ce qui est Interdit

| Non-conforme | Raison |
|---|---|
| `/views/dist/` | Non conforme PrestaShop Addons |
| `/views/build/` | Non conforme PrestaShop Addons |
| `/assets/` Ã  la racine | Non conforme PrestaShop Addons |
| `build/`, `dist/` au root | Non conforme |
| Versioning custom | Utiliser Webpack Encore uniquement |

## ğŸ“ Template Twig - RÃ©fÃ©rencer les Assets

```twig
{# âœ… CORRECT - Chemins selon la structure #}
<link rel="stylesheet" href="{{ 'https://your-cdn.com/modules/modulestarter/views/css/admin.css' }}">
<script src="{{ 'https://your-cdn.com/modules/modulestarter/views/js/admin.js' }}"></script>
<img src="{{ 'https://your-cdn.com/modules/modulestarter/views/img/logo.png' }}" alt="Logo">

{# âŒ JAMAIS - Ancien path /views/dist/ #}
<link rel="stylesheet" href="/modules/modulestarter/views/dist/admin.css">
```

## ğŸ“‹ Validation Pre-Build

Avant tout build, vÃ©rifier que :

```bash
# âœ… VÃ©rifier la configuration
cat webpack.config.js | grep -A 2 "setOutputPath"
# Doit afficher: setOutputPath('views/js/')

cat webpack.config.js | grep -A 2 "configureMiniCssExtractPlugin"
# Doit afficher: pluginOptions.filename = '../css/[name].css'

cat webpack.config.js | grep -A 2 "copyFiles"
# Doit afficher: to: '../img/[path][name].[hash:8].[ext]'

# âœ… AprÃ¨s build, vÃ©rifier l'arborescence
ls -la views/js/          # Doit contenir les .js compilÃ©s
ls -la views/css/         # Doit contenir les .css compilÃ©s
ls -la views/img/         # Doit contenir les images

# âŒ Ces dossiers ne doivent PAS exister
ls -la views/dist/        # âŒ ERREUR si existe
ls -la views/build/       # âŒ ERREUR si existe
ls -la assets/            # âŒ ERREUR si existe
```

## ğŸ”„ Build Process

```bash
# Development avec watch
npm run dev

# Production (avec versioning et minification)
npm run build

# VÃ©rifier les paths gÃ©nÃ©rÃ©s
npm run build && cat views/js/manifest.json
```

## ğŸ“Œ Checklist Avant Commit

- [ ] `webpack.config.js` utilise `views/js/` comme output
- [ ] CSS redirigÃ© vers `views/css/` via `configureMiniCssExtractPlugin`
- [ ] Images copiÃ©es vers `views/img/`
- [ ] Pas de dossier `views/dist/`, `views/build/`, ni `assets/`
- [ ] `manifest.json` prÃ©sent dans `views/js/`
- [ ] Versioning activÃ© en production uniquement
- [ ] Tous les assets compilÃ©s accessibles via PrestaShop

## ğŸš¨ Erreurs Courantes

| Erreur | Cause | Solution |
|----|----|---|
| `404 on CSS/JS` | Output path mauvais | VÃ©rifier `setOutputPath()` |
| `Versioning files not found` | Manifest path incohÃ©rent | VÃ©rifier `setManifestKeyPrefix()` |
| `Assets in views/dist/` | Webpack config obsolÃ¨te | Utiliser la config template |
| `Images not compiled` | copyFiles pattern mauvais | VÃ©rifier le `pattern` regex |

## ğŸ¯ PrestaShop Addons Compliance

Cette configuration garantit la conformitÃ© avec PrestaShop Addons Marketplace:

```
âœ… Structure validÃ©e par PrestaShop
âœ… Chemins standards (js/, css/, img/)
âœ… Aucun dossier non-standard
âœ… Cache busting via manifest.json
âœ… Support versioning production
```
